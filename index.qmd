---
title: "Initial Report (Draft)"
author: "Ad-hoc Committee on Graduate Stipends"
date: "2023/01/20"
format: 
  revealjs:
    width: 1785
    height: 1190
    slide-number: true
#    show-slide-number: print
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(
  echo = FALSE, message = FALSE, warning = FALSE, cache = TRUE,
  fig.retina = 3, fig.align = 'center', out.width = '100%', 
  fig.width = 10, fig.height = 8
  )

library(tidyverse)

load("stipends_2023.RData")

load("single_stipend_2023.RData")

```

## Key Questions 

* What does stipend utilization look like at OHIO? 
  * Stipend types include GA, TA, RA, GRS, and RD (The Patton CoE only)

* How has utilization changed over time at OHIO? 
  * Stipend data are for Fall terms beginning in Fall 2017 (aka Appointment Year 2018) through Fall 2022 (aka Appointment Year 2023) 
  * Include (1) amount in nominal dollars, and (2) work hours

* How do OHIO's graduate stipends fare vs those paid by 48 peer institutions (see below) in 2021-2022? 

> ASU (AZ), Auburn (AL) BGSU (OH), Clemson (SC), FAMU (FL), FSU (FL), Kansas State (KS), Kent State (OH), LSU (LA), Miami (OH), Mississippi State (MS), Montana State (MT), New Mexico State (NM), NCSU (NC), Oklahoma State (OK), Oregon State (OR), SDSU (SD), SIU Carbondale (IL), TAMU (TX), Texas Tech (TX), U Alabama, U Arizona, U Arkansas, UC Colorado Springs (CO), UC Denver (CO), U Delaware, U Georgia (GA), U Idaho (ID), U Iowa (IA), U Louisville (KY), Missouri at Columbia, Missouri at Kansas City, Missouri at St. Louis, U Montana, U Nebraska at Lincoln, U Nevada at Reno, U New Mexico, UNC Greensboro, U North Dakota, U Oklahoma, U Rhode Island, U South Dakota, U South Florida, UT Knoxville, U Utah, U Vermont, Utah State, Wayne State (MI)

---

## Caveats

* All results that follow are based on this decision. Specifically, whereas there are a total of `r length(unique(stipends$hashid))` students with contracts, our analysis focuses on a subset of `r length(unique(single_stipend$hashid))` students, i.e., `95.3%` of total contracted students.  

* `Who got left out?` Students with funding from multiple accounts in a given Fall term 


* `Will these be included later?` By February we anticipate having the complete data set analyzed. 

---


## An initial look at the data 

```{r}

single_stipend %>%
  group_by(appointment_year, stipend_type) %>%
  count() %>%
  group_by(appointment_year) %>%
  mutate(Total = sum(n)) %>%
  group_by(appointment_year, Total) %>%  
  pivot_wider(
    names_from = stipend_type,
    values_from = n
    )  -> tab01

single_stipend %>%
  group_by(
    appointment_year, school, stipend_type
    ) %>%
  count() %>%
  group_by(appointment_year, school) %>%
  mutate(Total = sum(n)) %>%
  ungroup() %>%
  group_by(school, appointment_year, Total) %>%
  pivot_wider(
    names_from = stipend_type,
    values_from = n
    ) -> tab02

single_stipend %>%
  group_by(
    appointment_year, school, program_name, stipend_type
    ) %>%
  count() %>%
  group_by(appointment_year, school, program_name) %>%
  mutate(Total = sum(n)) %>%
  group_by(
    appointment_year, school, program_name, Total
    ) %>%
  pivot_wider(
    names_from = stipend_type,
    values_from = n
    ) -> tab03

```

:::{.panel-tabset}

### Ohio University

```{r}

tab01 %>%
  rename(
    "Appointment Year (Fall)" = appointment_year
  ) %>%
  knitr::kable(
    booktabs = TRUE,
    caption = "Total Number of Students with a Stipend per Appointment Year") %>%
  kableExtra::kable_styling(
    full_width = FALSE, bootstrap_options = c("striped", "hover")
    ) 

```

### Colleges/Schools

```{r}

tab02 %>%
  arrange(
    school, appointment_year
  ) %>%
  rename(
    "Appointment Year (Fall)" = appointment_year,
    "College/School" = school
  ) %>%
  DT::datatable(
    caption = "Total No. of Funded Students by Appointment Year and College/School",
    rownames = FALSE,
    )

```

### Departments within Colleges/Schools

```{r}

tab03 %>%
  arrange(
    school, program_name, appointment_year
  ) %>%
  rename(
    "Appointment Year (Fall)" = appointment_year,
    "College/School" = school,
    "Program" = program_name
  ) %>%
  DT::datatable(
    caption = "Total No. of Funded Students by Appointment Year, College/School, and Program",
    rownames = FALSE,
    )

```

:::

---

## Distribution of Contracts 

::: {.panel-tabset}

### By Stipend Type in Fall 2022

```{r}

single_stipend %>%
  group_by(appointment_year, stipend_type, work_hours) %>%
  count() -> tab05

single_stipend %>%
  group_by(appointment_year, school, stipend_type, work_hours) %>%
  count() -> tab06

single_stipend %>%
  group_by(appointment_year, school, program_name, stipend_type, work_hours) %>%
  count() -> tab07

```

```{r, fig.width = 8, fig.height = 6, out.width = "80%"}

single_stipend %>%
  mutate(
    hours = ifelse(work_hours == 14.66, 15, work_hours),
    hours = factor(hours)
    ) %>%
  filter(appointment_year == 2023) %>%
  group_by(
    stipend_type, work_hours
  ) %>%
  summarize(
    number = n(),
    pct = number/1332
  ) -> mytab
  
  
single_stipend %>%
  mutate(
    hours = ifelse(work_hours == 14.66, 15, work_hours),
    hours = factor(hours)
    ) %>%
  filter(appointment_year == 2023) %>%
  ggplot() +
  geom_bar(
    aes(
      x = hours,
      group = stipend_type,
      fill = stipend_type
      )
    ) +
  facet_wrap(~ stipend_type, scales = "free_x") +
  ggsci::scale_fill_aaas() + 
  themeani::theme_ani_muli() +
  theme(legend.position = "bottom") +
  labs(
    x = "Fall Weekly Work Hours",
    y = "Number of Contracts Written",
    fill = ""
  ) 

```


### Ignoring Stipend Type, by Year

```{r, fig.width = 8, fig.height = 6, out.width = "80%"}

single_stipend %>%
  mutate(
    hours = ifelse(work_hours == 14.66, 15, work_hours)
    ) %>%
  ggplot() +
  geom_histogram(
    aes(
      x = hours,
      group = appointment_year,
      fill = hours
      )
    ) +
  facet_wrap(~ appointment_year, scales = "free_x") +
  themeani::theme_ani_muli() +
  theme(legend.position = "bottom") +
  labs(
    x = "Fall Weekly Work Hours",
    y = "Number of Contracts Written",
    fill = ""
  ) 

```

:::

---

## Hourly Rates in Fall 2022, by College/School

:::{.panel-tabset}

### Not adjusting for Inflation

```{r}

single_stipend %>%
  mutate(
    rate = fall_offer_amount / (work_hours * 15),
    rate_2022 = real_amount_2022 / (work_hours * 15)
    ) -> single_stipend

```

```{r, fig.height = 6, fig.width = 8, out.width = "75%"}

single_stipend %>%
  ungroup() %>%
  ggplot() +
  geom_violin(
    aes(
      x = rate,
      y = factor(appointment_year),
      group = appointment_year,
      fill = factor(appointment_year)
      )
    ) +
  geom_boxplot(
    aes(
      x = rate,
      y = factor(appointment_year),
      group = appointment_year
      ),
    width = 0.1
    ) +
  paletteer::scale_fill_paletteer_d("dutchmasters::milkmaid") +
  themeani::theme_ani_barlow() +
  theme(legend.position = "hide") +
  labs(
    x = "Hourly Rate (Not adjusted for inflation)",
    y = "Appointment Year"
  )

```


### Adjusting for Inflation

```{r, fig.height = 6, fig.width = 8, out.width = "75%"}

single_stipend %>%
  ungroup() %>%
  filter(rate_2022 < 100) %>%
  ggplot() +
  geom_violin(
    aes(
      x = rate_2022,
      y = factor(appointment_year),
      group = appointment_year,
      fill = factor(appointment_year)
      )
    ) +
  geom_boxplot(
    aes(
      x = rate_2022,
      y = factor(appointment_year),
      group = appointment_year
      ),
    width = 0.1
    ) +
  paletteer::scale_fill_paletteer_d("dutchmasters::milkmaid") +  
  themeani::theme_ani_barlow() +
  theme(legend.position = "hide") +
  labs(
    x = "Hourly Rate (inflation-adjusted for September 2021)",
    y = "Appointment Year"
  )
  
```

### Summary Statistics of Both Sets of Rates

```{r}

single_stipend %>%
  group_by(appointment_year) %>%
  filter(rate < 100, rate_2022 < 100) %>%
  summarize(
    mina = min(rate, na.rm = TRUE),
    maxa = max(rate, na.rm = TRUE),
    mediana = median(rate, na.rm = TRUE),
    minb = min(rate_2022, na.rm = TRUE),
    maxb = max(rate_2022, na.rm = TRUE),
    medianb = median(rate_2022, na.rm = TRUE)
    ) -> tab08

tab08 %>%
  select(1, 2, 4, 3, 5, 7, 6) %>%
  knitr::kable(
    booktabs = TRUE,
    row.names = FALSE, 
    col.names = c("Appointment Year", "Minimum", "Median", "Maximum", "Minimum", "Median", "Maximum"), 
#    caption = "Minimum, Median, and Maxium Rates, by Appointment Year",
    digits = c(0, 1, 1, 1, 1, 1, 1)
  ) %>%
  kableExtra::add_header_above(c(" " = 1, "Nominal" = 3, "Inflation-adjusted" = 3)) %>%
  kableExtra::kable_styling(full_width = FALSE, bootstrap_options = c("stiped", "hover"))

```

:::

---

## Peer Comparison of Fall 2021 Stipends

```{r}

single_stipend %>%
  filter(appointment_year == 2022) -> oufa21

readxl::read_excel(
  "cip-codes/Active Major Codes with CIP Code.xlsx",
  skip = 1
  ) %>%
  mutate(
    cip2010 = stringr::str_remove_all(CIP_CODE, "\\.")
    ) -> cip

oufa21 %>%
  left_join(
    cip,
    by = c("program_code" = "MAJOR_CODE")
    ) -> mydf_ou

load("stipends.RData")

stipends %>%
  filter(
    institution == "SEC A",
    faculty_rank == "All ranks combined"
    ) -> mydf_ok

mydf_ok %>%
  mutate(
    adjusted_cip = case_when(
      cip2010 == "160000" ~ "160105",
      cip2010 == "422700" ~ "422704",
      cip2010 == "450701" ~ "304401",
      cip2010 == "540000" ~ "540199",
      cip2010 == "090900" ~ "090905",
      cip2010 == "090700" ~ "110901",
      cip2010 == "500600" ~ "500406",
      cip2010 == "422800" ~ "511508",
      cip2010 == "512310" ~ "511508",
      cip2010 == "130400" ~ "130411",
      cip2010 == "131311" ~ "131214",
      cip2010 == "130100" ~ "131315",
      cip2010 == "142701" ~ "141301",
      cip2010 == "500500" ~ "500506",
      cip2010 == "500501" ~ "501001",
      cip2010 == "500501" ~ "501001",
      cip2010 == "500400" ~ "500409",
      cip2010 == "131312" ~ "500912",
      cip2010 == "301901" ~ "513199",
      cip2010 == "050201" ~ "050101",
      cip2010 == "160300" ~ "050103",
      TRUE ~ cip2010
    )
  ) -> mydf_ok

mydf_ou %>%
  left_join(
    mydf_ok,
    by = c("cip2010" = "adjusted_cip")
    ) -> mydf

mydf %>%
  group_by(program_code) %>%
  mutate(
    annual_amount = (fall_offer_amount * 2)
    ) -> mydf

mydf %>%
  select(
    school, program_name, program_code, low_stipend, 
    average_stipend, high_stipend, cip2010,
    annual_amount
    ) -> mydf_sub

```

:::{.panel-tabset}

### Arts & Sciences

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "Arts & Sciences") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) + 
  annotate("text", x = "English", y = 60000, label = "Peer Maximum", color = "limegreen") + 
  annotate("text", x = "Clinical Psychology", y = 60000, label = "Peer Average", color = "mediumpurple3") +
  annotate("text", x = "Biological Sciences", y = 60000, label = "Peer Minimum", color = "tomato") +
  annotate("text", x = "History", y = 60000, label = "OH stipends", color = "black") +  
  annotate("text", x = "Indust/Organiz Psychology", y = 60000, label = "| OH Median", color = "black") +  
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "Arts & Sciences"
  ) 

```

### Business

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "Business") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) +   
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "Business"
  )

```

### Scripps

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "Communication") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) +   
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "Communication"
  )

```

### Patton

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "Education") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) +   
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "Education"
  )

```

### Russ

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "Engineering & Technology") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) +   
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "Engineering & Technology"
  )

```

### Fine Arts

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "Fine Arts") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) +   
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "Fine Arts"
  )

```

### Graduate 

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "Graduate") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) +   
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "Graduate"
  )

```


### Voinovich 

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "GVS Leadership & Pub Affairs") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) +   
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "Voinovich"
  )

```

### CHSP

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "Health Sciences & Professions") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) +   
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "Health Sciences & Professions"
  )

```

### International Studies

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "International Studies") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) +   
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "International Studies"
  )

```

### HCOM

```{r, fig.height = 6, fig.width = 8, out.width = "70%"}

mydf %>%
  ungroup() %>%
  filter(school_name == "Osteopathic Medicine") %>%
  ggplot() +
  geom_boxplot(
    aes( 
      x = program_name,
      y = annual_amount
      ),
    fill = "aliceblue",
    color = "black"
      ) + 
  geom_point(
    aes( 
      x = program_name,
      y = average_stipend
      ),
    color = "mediumpurple3"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = low_stipend
      ),
    color = "tomato"
      ) +   
  geom_point(
    aes( 
      x = program_name,
      y = high_stipend
      ),
    color = "limegreen"
      ) +   
  coord_flip() +
  themeani::theme_ani_muli() +
  labs(
    x = "Programs",
    y = "Annual Stipends",
    title = "Osteopathic Medicine"
  )

```


:::


---

## Wrap-up

(1) ### Questions?

. . . 

(2) ### Next Steps ...

    (a) Cleaning up the rest of the data 
  
    (b) Adding missing CIP Codes for programs 
  
    (c) High-level write-up of our findings 
  
    (d) All tables created for report available to the Colleges/Schools 


